<!DOCTYPE html>
<html>
  <head>
    <title>F2P Decks</title>
    <meta charset="utf-8" />
    <link rel="icon" type="image/x-icon" href="images/logo.png" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");
    </style>
    <script src="lib/css-picker.js"></script>
    <script src="lib/skilldb-dl.js"></script>
    <script src="lib/f2pdeckdb.js"></script>
  </head>
  <body>
    <div class="flexdivc">
      <div style="text-align: center; width: min-content">
        <h1>Free to Play Decks</h1>
        <p>A list of decks that meet the DLF2P F2P requirements</p>
        <div class="flexdivc">
          <p id="btnRush" class="tglbtn" onclick="showRush()">
            Deck type: Speed
          </p>
          <p id="btnSort" class="tglbtn" onclick="sortBy()">
            Sort decks by: Name
          </p>
        </div>
        <table>
          <tr>
            <th>Archetype</th>
            <th>User</th>
            <th>Skill</th>
            <th>Date</th>
          </tr>
        </table>
      </div>
    </div>
  </body>
  <script src="lib/navbar-handler.js"></script>
  <script>
    var tbInnerHtml = document.getElementsByTagName("table")[0].innerHTML;
    const mth = " Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");
    document.getElementById("btnRush").innerHTML = "Deck type: Speed";
    document.getElementById("btnSort").innerHTML = "Sort decks by: Date";
    function showRush() {
      if (document.getElementById("btnRush").innerHTML == "Deck type: Speed") {
        document.getElementById("btnRush").innerHTML = "Deck type: Rush";
      } else {
        document.getElementById("btnRush").innerHTML = "Deck type: Speed";
      }
      refresh();
    }
    function sortBy() {
      switch (document.getElementById("btnSort").innerHTML) {
        case "Sort decks by: Date":
          document.getElementById("btnSort").innerHTML = "Sort decks by: Name";
          break;
        case "Sort decks by: Name":
          document.getElementById("btnSort").innerHTML = "Sort decks by: Date";
          break;
      }
      refresh();
    }
    function refresh() {
      let sortedList = jsonResponseF2pDecks.filter((a) =>
        document.getElementById("btnRush").innerHTML == "Deck type: Speed"
          ? !jsonResponseSkill[a.url.split("_")[1]].description.includes(
              "[EFFECT]"
            )
          : jsonResponseSkill[a.url.split("_")[1]].description.includes(
              "[EFFECT]"
            )
      );
      switch (document.getElementById("btnSort").innerHTML) {
        case "Sort decks by: Name":
          sortedList = sortedList.sort((a, b) =>
            a.archetype.localeCompare(b.archetype)
          );
          break;
        case "Sort decks by: Date":
          sortedList = sortedList.sort(
            (a, b) =>
              Number(
                b.date.slice(b.date.length - 4) * 10000 +
                  mth.indexOf(b.date.slice(0, 3 - b.date.length)) * 100 +
                  b.date.slice(4, b.date.length - 6)
              ) -
              Number(
                a.date.slice(a.date.length - 4) * 10000 +
                  mth.indexOf(a.date.slice(0, 3 - a.date.length)) * 100 +
                  a.date.slice(4, a.date.length - 6)
              )
          );
          break;
      }
      document.getElementsByTagName("table")[0].innerHTML = tbInnerHtml;
      for (let i = 0; i < sortedList.length; i++) {
        document.getElementsByTagName("table")[0].innerHTML +=
          '<tr onclick="window.location=' +
          "'" +
          sortedList[i].url +
          "'" +
          ';"><td>' +
          sortedList[i].archetype +
          "</td><td>" +
          sortedList[i].user +
          "</td><td>" +
          jsonResponseSkill[sortedList[i].url.split("_")[1]].name +
          "</td><td>" +
          sortedList[i].date +
          "</td></tr>";
      }
    }
    refresh();
  </script>
</html>
